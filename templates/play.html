{% extends "layout.html" %}

{% block title %}
Play
{% endblock %}

{% block main %}
<h1 class="text-danger">Play Cards</h1>
<div id="card-holder">
    <div class="card-display">
        <p id="card-name">{{ current_card.rank }} of {{ current_card.suit }}</p>
        <p id="card-attributes" {% if not flip %}style="display: none;" {% endif
            %}>
            Person: {{ current_card.person }}<br>
            Action: {{ current_card.action }}<br>
            Object: {{ current_card.obj }}
        </p>
    </div>
    <button class="btn btn-primary" id="flip-button">Flip</button>
    <button class="btn btn-primary" id="next-button">Next</button>
</div>
<script>
    // parse the cards data passed from the backend
    const cards = JSON.parse('{{ cards|tojson|safe }}');
    let currentCardIndex = {{ current_card_index }};
    let currentCard = cards[currentCardIndex];
    let isFlipped = {{ flip }};

    //update the card name and attributes displayed on the page
    const cardName = document.querySelector("#card-name");
    cardName.innerText = `${currentCard.rank} of ${currentCard.suit}`;
    const cardAttributes = document.querySelector("#card-attributes");
    cardAttributes.innerHTML = `Person: ${currentCard.person}<br>
                                Action: ${currentCard.action}<br>
                                Object: ${currentCard.obj}`;

    // toggle the visibility of the card attributes when the flip button is clicked
    const flipButton = document.querySelector("#flip-button");
    flipButton.addEventListener("click", () => {
        isFlipped = !isFlipped;
        cardAttributes.style.display = isFlipped ? "block" : "none";
    });

    // increment the current_card_index and update the current card displayed when the next button is clicked
    const nextButton = document.querySelector("#next-button");
    nextButton.addEventListener("click", () => {
        currentCardIndex = (currentCardIndex + 1) % cards.length;
        currentCard = cards[currentCardIndex];
        cardName.innerText = `${currentCard.rank} of ${currentCard.suit}`;
        cardAttributes.innerHTML = `Person: ${currentCard.person}<br>
                                    Action: ${currentCard.action}<br>
                                    Object: ${currentCard.obj}`;
    });
</script>
{% endblock %}